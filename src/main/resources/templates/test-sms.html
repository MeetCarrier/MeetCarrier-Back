<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>SMS ì¸ì¦ í…ŒìŠ¤íŠ¸</title>
    <script>
        function savePhoneNumber() {
            const userPhone = document.getElementById("userPhone").value;
            localStorage.setItem("userPhone", userPhone);
        }

        function setPhoneNumberInHiddenField() {
            const storedPhone = localStorage.getItem("userPhone");
            if (storedPhone) {
                document.getElementById("hiddenUserPhone").value = storedPhone;
            }
        }
    </script>
</head>
<body>
<button onclick="loginAsTestUser()">ğŸ§ª í…ŒìŠ¤íŠ¸ ìœ ì €ë¡œ ë¡œê·¸ì¸</button>
<p id="loginStatus" style="color: green;"></p>
<h2>ğŸ“± íœ´ëŒ€í° ë²ˆí˜¸ ì…ë ¥</h2>
<form th:action="@{/api/send-sms}" method="post" onsubmit="savePhoneNumber()">
    <label for="userPhone">íœ´ëŒ€í° ë²ˆí˜¸:</label>
    <input type="text" id="userPhone" name="userPhone" placeholder="01012345678" required>
    <button type="submit">ì¸ì¦ë²ˆí˜¸ ìš”ì²­</button>
</form>

<hr>

<h2>ğŸ” ì¸ì¦ë²ˆí˜¸ ì…ë ¥</h2>
<form th:action="@{/api/verify-sms}" method="post" onsubmit="setPhoneNumberInHiddenField()">
    <!-- ìˆ¨ê²¨ì§„ ì „í™”ë²ˆí˜¸ í•„ë“œ -->
    <input type="hidden" id="hiddenUserPhone" name="userPhone">

    <label for="smsCode">ì¸ì¦ë²ˆí˜¸:</label>
    <input type="text" id="smsCode" name="smsCode" required>

    <button type="submit">ì¸ì¦ë²ˆí˜¸ í™•ì¸</button>
</form>
<script>
    function loginAsTestUser() {
        fetch('/api/auth/test/login', {
            method: 'POST',
            credentials: 'include' // JSESSIONID ì¿ í‚¤ ì €ì¥
        })
            .then(res => {
                if (res.ok) {
                    document.getElementById('loginStatus').textContent = 'âœ… í…ŒìŠ¤íŠ¸ ìœ ì €ë¡œ ë¡œê·¸ì¸ ì„±ê³µ';
                } else {
                    document.getElementById('loginStatus').textContent = 'âŒ ë¡œê·¸ì¸ ì‹¤íŒ¨';
                }
            })
            .catch(error => {
                console.error('ë¡œê·¸ì¸ ì˜¤ë¥˜:', error);
                document.getElementById('loginStatus').textContent = 'âŒ ë¡œê·¸ì¸ ì˜¤ë¥˜ ë°œìƒ';
            });
    }
</script>
</body>
</html>
